name: Weekly Brand Update

on:
  schedule:
    # Run at 00:00 on Sunday
    - cron: '0 0 * * 0'
  workflow_dispatch: # Allows manual trigger button

permissions:
  contents: write

jobs:
  update-database:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Libraries
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4

      - name: Run Scrapers (Order Matters!)
        run: |
          cd backend
          # 1. Run Disoccupied first (Primary Source)
          echo "ðŸš€ Running Disoccupied Scraper..."
          python full_disoccupied_scraper.py
          
          # 2. Run Builder second (Fill gaps)
          echo "ðŸš€ Running Builder (Boycott-Israel)..."
          python builder.py

      - name: Commit and Push
        run: |
          git config --global user.name "BoyKot Bot"
          git config --global user.email "bot@boykot.app"
          
          if [[ -n $(git status --porcelain) ]]; then
            git add app/assets/boycott_data.json
            git add app/assets/images/*
            git commit -m "ðŸ¤– Weekly Data Update: $(date +'%Y-%m-%d')"
            git push
          else
            echo "No changes found."
          fi